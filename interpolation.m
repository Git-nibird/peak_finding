close all
clear all

%% ----- Plot Setting ------

% Defaults
width = 5;     % Width in inches
height = 4;    % Height in inches
alw = 0.75;    % AxesLineWidth
fsz = 16;      % Fontsize
lw = 1.5;      % LineWidth
msz = 8;       % MarkerSize

% The properties we've been using in the figures
set(0,'defaultLineLineWidth',lw);   % set the default line width to lw
set(0,'defaultLineMarkerSize',msz); % set the default line marker size to msz

% Set the default Size for display
defpos = get(0,'defaultFigurePosition');
set(0,'defaultFigurePosition', [defpos(1) defpos(2) width*100, height*100]);

% add this line after each plot to change font size and line width
% set(gca, 'FontSize', fsz, 'LineWidth', alw); %<- Set properties

%% ----- Read Data -----
alpha = [-2.58 -2.58 -2.59 -2.60 -2.61 -2.61 -2.62 -2.63 -2.62 -2.62 -2.63 -2.63 -2.63 -2.64 -2.65 -2.64 -2.65 -2.66 -2.67 -2.67 -2.66 -2.67 -2.66 -2.66 -2.66 -2.67 -2.68 -2.69 -2.69 -2.70 -2.71 -2.72 -2.72 -2.71 -2.71 -2.71 -2.74 -2.75 -2.75 -2.75 -2.76 -2.76 -2.77 -2.76 -2.77 -2.78 -2.79 -2.80 -2.81 -2.82 -2.82 -2.86 -2.86 -2.87 -2.89 -2.90 -2.90 -2.90 -2.89 -2.90 -2.91 -2.91 -2.91 -2.92 -2.92 -2.93 -2.93 -2.93 -2.94 -2.94 -2.94 -2.95 -2.95 -2.96 -2.96 -2.96 -2.96 -2.96 -2.96 -2.97 -2.98 -2.97 -2.98 -2.98 -2.99 -2.98 -2.99 -2.99 -3.00 -2.99 -2.98 -2.98 -2.99 -2.99 -2.99 -3.00 -3.00 -3.01 -3.01 -3.02 -3.01 -3.00 -3.00 -3.01 -3.01 -3.02 -3.03 -3.02 -3.01 -3.03 -3.03 -3.04 -3.03 -3.04 -3.04 -3.05 -3.05 -3.06 -3.06 -3.07 -3.06 -3.11 -3.13 3.14 3.13 3.11 3.11 3.05 3.03 3.02 3.00 2.98 2.96 2.94 2.93 2.89 2.87 2.84 2.83 2.78 2.76 2.45 2.43 2.28 2.26 2.05 2.03 1.92 1.91 1.85 1.85 1.80 1.78 1.72 1.72 1.70 1.69 1.66 1.65 1.64 1.64 1.62 1.62 1.60 1.60 1.59 1.59 1.57 1.57 1.56 1.56 1.54 1.54 1.53 1.53 1.52 1.52 1.50 1.50 1.49 1.49 1.47 1.47 1.45 1.45 1.44 1.44 1.43 1.43 1.38 1.38 1.37 1.36 1.35 1.34 1.32 1.31 1.31 1.29 1.28 1.24 1.24 1.23 1.21 1.22 1.21 1.22 1.21 1.23 1.22 1.24 1.23 1.24 1.23 1.25 1.25 1.25 1.25 1.26 1.25 1.26 1.25 1.26 1.25 1.26 1.25 1.26 1.25 1.26 1.25 1.26 1.25 1.26 1.25 1.27 1.26 1.27 1.26 1.21 1.11 1.10 1.11 1.08 1.09 1.07 1.08 1.07 1.07 1.06 1.07 1.05 1.06 1.05 1.05 1.05 1.05 1.03 1.04 1.03 1.03 1.02 1.03 1.02 1.03 1.02 1.03 1.01 1.02 1.01 1.00 1.00 0.96 0.95 0.95 0.91 0.91 0.90 0.88 0.88 0.88 0.88 0.87 0.87 0.87 0.87 0.87 0.87 0.86 0.87 0.86 0.86 0.85 0.86 0.85 0.85 0.84 0.85 0.84 0.84 0.83 0.83 0.82 0.83 0.82 0.82 0.81 0.81 0.80 0.80 0.79 0.79 0.79 0.79 0.78 0.78 0.77 0.77 0.76 0.75 0.74 0.74 0.71 0.64 0.64 0.63 0.66 0.65 0.66 0.65 0.67 0.66 0.66 0.66 0.67 0.66 0.68 0.67 0.67 0.67 0.67 0.67 0.67 0.64 0.61 0.56 0.55 0.54 0.52 0.53 0.50 0.49 0.48 0.47 0.46 0.47 0.43 0.43 0.43 0.42 0.42 0.34 0.33 0.31 0.29 0.26 0.25 0.26 0.25 0.26 0.26 0.28 0.27 0.28 0.28 0.28 0.28 0.29 0.28 0.29 0.29 0.29 0.29 0.30 0.30 0.30 0.30 0.30 0.30 0.31 0.30 0.31 0.31 0.31 0.31 0.32 0.31 0.32 0.31 0.32 0.32 0.33 0.33 0.33 0.33 0.33 0.33 0.34 0.33 0.34 0.33 0.32 0.32 0.30 0.29 0.28 0.27 0.26 0.26 0.25 0.24 0.22 0.22 0.20 0.21 0.20 0.20 0.19 0.19 0.18 0.18 0.16 0.16 0.15 0.15 0.14 0.14 0.13 0.13 0.11 0.11 0.10 0.10 0.10 0.10 0.08 0.08 0.06 0.06 0.05 0.05 0.04 0.04 0.01 0.01 0.00 0.00 -0.03 -0.03 -0.07 -0.07 -0.12 -0.12 -0.24 -0.26 -0.26 -0.29 -0.30 -0.50 -0.52 -0.53 -0.35 -0.36 -0.34 -0.35 -0.34 -0.35 -0.35 -0.35 -0.35 -0.35 -0.35 -0.36 -0.36 -0.38 -0.38 -0.39 -0.40 -0.40 -0.44 -0.48 -0.51 -0.51 -0.54 -0.53 -0.60 -0.61 -0.65 -0.67 -0.71 -0.73 -0.77 -0.79 -0.81 -0.83 -0.85 -0.87 -0.90 -0.92 -0.95 -0.97 -1.06 -1.08 -1.30 -1.32 -1.54 -1.55 -1.69 -1.71 -1.81 -1.83 -1.88 -1.90 -1.92 -1.94 -2.03 -2.04 -2.06 -2.06 -2.09 -2.10 -2.13 -2.14 -2.17 -2.18 -2.21 -2.22 -2.24 -2.24 -2.25 -2.25 -2.30 -2.31 -2.31 -2.31 -2.32 -2.34 -2.39 -2.39 -2.40 -2.41 -2.41 -2.43 -2.46 -2.46 -2.46 -2.46 -2.47 -2.49 -2.50 -2.51 -2.51 -2.50 -2.53 -2.54 -2.54 -2.55 -2.54 -2.55 -2.56 -2.56 -2.56 -2.58 -2.58 -2.57 -2.58 -2.61 -2.60 -2.57 -2.57];
r = [15172.00 15041.00 15121.00 15332.00 15205.00 14869.00 14957.00 15385.00 15725.00 15850.00 15944.00 16290.00 15944.00 15821.00 15921.00 16265.00 15921.00 16025.00 17170.00 17524.00 17768.00 17882.00 18244.00 18369.00 18244.00 17882.00 17642.00 17764.00 18005.00 18133.00 18020.00 18154.00 18512.00 18625.00 18989.00 19493.00 19925.00 20714.00 21092.00 21361.00 21521.00 21794.00 21960.00 22736.00 23585.00 23761.00 24929.00 25309.00 26218.00 26420.00 27040.00 26361.00 25961.00 26185.00 25936.00 25546.00 25780.00 25469.00 25237.00 24473.00 24400.00 24026.00 23725.00 23357.00 23290.00 22928.00 22633.00 22277.00 22216.00 21866.00 21290.00 20948.00 21178.00 20840.00 19720.00 19394.00 18850.00 18532.00 18265.00 17953.00 17908.00 16868.00 16276.00 16025.00 15737.00 14761.00 14485.00 14248.00 13978.00 13058.00 12868.00 12645.00 12389.00 11953.00 11705.00 11889.00 11461.00 11221.00 11012.00 10778.00 10573.00 10397.00 10196.00 9970.00 9578.00 9360.00 9337.00 9169.00 8793.00 8381.00 7496.00 7306.00 6805.00 6625.00 6305.00 6133.00 5825.00 5661.00 5220.00 5066.00 4250.00 3848.00 3845.00 3721.00 3722.00 3604.00 3485.00 3161.00 3172.00 3074.00 3089.00 2997.00 3016.00 2930.00 2825.00 2669.00 2696.00 2626.00 2657.00 2533.00 2570.00 2196.00 2125.00 2125.00 2066.00 2248.00 2205.00 2405.00 2372.00 2500.00 2597.00 2745.00 2722.00 2980.00 3089.00 3185.00 3298.00 3506.00 3625.00 3737.00 3860.00 3978.00 4105.00 4229.00 4360.00 4490.00 4625.00 4761.00 4900.00 5042.00 5185.00 5333.00 5629.00 5785.00 5938.00 6100.00 6257.00 6597.00 6760.00 6938.00 7105.00 7477.00 7650.00 8042.00 8402.00 8608.00 8793.00 9005.00 9194.00 10804.00 11009.00 11050.00 11554.00 11601.00 11861.00 11965.00 12233.00 12290.00 12136.00 12260.00 11834.00 11629.00 11497.00 10512.00 10250.00 9874.00 9620.00 9437.00 8945.00 8768.00 8296.00 8125.00 7897.00 7730.00 7290.00 7129.00 6917.00 6760.00 6554.00 6250.00 6052.00 5905.00 5713.00 5429.00 5245.00 4973.00 4797.00 4537.00 4369.00 4121.00 3961.00 3725.00 3573.00 3349.00 3205.00 3098.00 2960.00 2756.00 2628.00 2880.00 3026.00 3125.00 3757.00 3866.00 4210.00 4325.00 4689.00 4810.00 5194.00 5321.00 5933.00 6068.00 6722.00 6865.00 7093.00 7240.00 8704.00 8865.00 9389.00 9556.00 10378.00 10553.00 11125.00 11306.00 11898.00 12085.00 13645.00 13844.00 15172.00 15305.00 15649.00 16354.00 16292.00 16441.00 16285.00 16084.00 16042.00 15457.00 15109.00 14920.00 14578.00 14393.00 14057.00 13876.00 13220.00 13045.00 12409.00 12240.00 11322.00 11161.00 10573.00 10418.00 10132.00 9981.00 9425.00 9280.00 9010.00 8869.00 8605.00 8468.00 8210.00 8077.00 7825.00 7696.00 7450.00 7325.00 7085.00 6964.00 6500.00 6385.00 6161.00 6050.00 5832.00 5725.00 5513.00 5410.00 5002.00 4905.00 4709.00 4616.00 4240.00 3985.00 4045.00 4225.00 4330.00 5930.00 6053.00 7193.00 7328.00 9106.00 9257.00 9805.00 9962.00 11412.00 11581.00 15145.00 15338.00 16400.00 16601.00 16965.00 17170.00 17540.00 18605.00 18785.00 17444.00 16370.00 16237.00 13885.00 13682.00 10964.00 10865.00 10309.00 10216.00 9680.00 9505.00 7537.00 7380.00 7154.00 7085.00 6932.00 4754.00 4709.00 4797.00 4756.00 4948.00 5365.00 5545.00 5690.00 5876.00 6025.00 6413.00 6568.00 6770.00 7090.00 7300.00 7465.00 7681.00 8021.00 8245.00 8420.00 8650.00 8829.00 9065.00 9248.00 9490.00 9866.00 10116.00 10309.00 10565.00 10762.00 11024.00 11225.00 11493.00 11698.00 11972.00 12181.00 12461.00 12889.00 13469.00 13690.00 14290.00 14517.00 14825.00 15289.00 15605.00 15842.00 16164.00 16648.00 16978.00 17725.00 17893.00 18148.00 18500.00 18421.00 18605.00 18457.00 18125.00 18056.00 17730.00 17665.00 16409.00 16160.00 15266.00 15025.00 14737.00 14500.00 13940.00 13709.00 13169.00 12944.00 12424.00 12205.00 11705.00 11492.00 11250.00 11041.00 10573.00 10169.00 9725.00 9530.00 9316.00 9125.00 8917.00 8730.00 8330.00 8149.00 7769.00 7594.00 7412.00 7241.00 7065.00 6898.00 6562.00 6401.00 6241.00 6084.00 5780.00 5629.00 5209.00 5066.00 4688.00 4553.00 3825.00 3856.00 3737.00 3653.00 3688.00 3130.00 3185.00 3341.00 7082.00 7300.00 7956.00 8186.00 8530.00 8768.00 8945.00 9189.00 9370.00 9620.00 9805.00 10321.00 10512.00 11322.00 11401.00 11681.00 11764.00 12050.00 12505.00 12205.00 10882.00 10600.00 9556.00 9290.00 7585.00 7541.00 6856.00 6826.00 6082.00 6068.00 5620.00 5618.00 5309.00 5317.00 5125.00 5141.00 4961.00 4985.00 4736.00 4770.00 4273.00 4325.00 3620.00 3706.00 3485.00 3365.00 3413.00 3313.00 3445.00 3361.00 3460.00 3386.00 3425.00 3357.00 3645.00 3809.00 3866.00 4036.00 4160.00 4338.00 4545.00 4733.00 4964.00 5162.00 5417.00 5837.00 5809.00 6025.00 6122.00 6344.00 6869.00 6857.00 7093.00 7218.00 7450.00 7444.00 8200.00 8458.00 8468.00 8605.00 8869.00 9298.00 9346.00 9620.00 9773.00 10053.00 10369.00 10405.00 10733.00 10777.00 11069.00 11194.00 12069.00 12125.00 12433.00 12618.00 12932.00 12618.00 12680.00 12869.00 13185.00 13325.00 13645.00 13770.00 13645.00 13801.00 14785.00 14629.00 14965.00];

% alpha = [-1.45 -1.65 -1.72 -1.74 -1.84 -1.92 -2.29 -2.36 -2.29 -2.16 -2.13 -2.27 -2.45 -2.52 -2.68 -2.72 -2.68 -2.75 -2.82 -3.08 -3.08 3.14 3.08 3.14 -3.09 3.14 -3.05 -3.05 -3.10 3.14 3.14 3.11 3.07 3.04 3.05 3.08 3.11 3.11 3.14 3.14 3.11 3.08 3.11 3.08 3.03 3.03 3.01 3.04 3.06 3.09 3.06 3.04 3.01 3.02 2.99 2.97 3.00 3.02 3.03 3.00 3.00 2.97 2.99 2.96 2.94 2.88 2.86 2.85 2.89 2.88 2.85 2.83 2.82 2.78 2.75 2.79 2.71 2.68 2.64 2.65 2.60 2.55 2.51 2.52 2.47 2.41 2.39 2.39 2.36 2.36 2.27 2.19 2.14 2.23 2.21 2.03 2.00 1.84 1.95 1.82 1.21 1.11 1.03 1.06 0.93 0.79 0.54 0.57 0.49 0.46 0.37 0.32 0.28 0.21 0.13 0.19 0.06 0.10 0.05 0.05 0.00 -0.04 -0.08 -0.07 -0.03 -0.03 0.00 0.00 -0.03 -0.05 -0.08 -0.18 -0.19 -0.22 -0.24 -0.28 -0.29 -0.32 -0.33 -0.37 -0.39 -0.43 -0.46 -0.51 -0.57 -0.62 -0.67 -0.73 -1.27 -1.31 -1.37];
% r = [260.00 170.00 173.00 148.00 130.00 137.00 113.00 98.00 113.00 117.00 89.00 61.00 61.00 74.00 80.00 97.00 125.00 169.00 160.00 226.00 257.00 256.00 290.00 324.00 325.00 361.00 445.00 533.00 530.00 576.00 784.00 842.00 845.00 909.00 1033.00 1093.00 1025.00 962.00 961.00 1024.00 1025.00 1093.00 1157.00 1093.00 1241.00 1312.00 1394.00 1460.00 1453.00 1373.00 1453.00 1460.00 1546.00 1625.00 1636.00 1730.00 1800.00 1789.00 1874.00 1885.00 1800.00 1730.00 1636.00 1570.00 1585.00 1469.00 1565.00 1490.00 1306.00 1237.00 1189.00 1277.00 1210.00 1168.00 1352.00 1394.00 1314.00 1125.00 1097.00 1009.00 850.00 832.00 740.00 666.00 586.00 580.00 545.00 481.00 450.00 338.00 290.00 296.00 277.00 269.00 225.00 180.00 146.00 130.00 116.00 68.00 73.00 125.00 136.00 106.00 100.00 128.00 136.00 170.00 218.00 180.00 194.00 250.00 212.00 205.00 229.00 265.00 325.00 365.00 401.00 485.00 529.00 530.00 580.00 845.00 901.00 1025.00 1089.00 1296.00 1370.00 1373.00 1453.00 1493.00 1418.00 1360.00 1377.00 1325.00 1256.00 1210.00 1145.00 1105.00 985.00 953.00 845.00 821.00 680.00 666.00 586.00 580.00 281.00 241.00 234.00];

% plot raw data
figure, plot(alpha, r, '.');
set(gca, 'FontSize', fsz, 'LineWidth', alw); %<- Set properties
title('Raw Data')
xlabel('\alpha (rad)')
ylabel('R')

%% ----- Interpolate Data To a Dense Grid -----
n_data = length(alpha);

ID = 1:1:n_data;
grid = 1:0.01:n_data;

alpha_intp = interp1(ID, alpha, grid, 'linear');
r_intp = interp1(ID, r, grid, 'linear');

% plot interpolated result
figure, plot(alpha_intp, r_intp, '.');
set(gca, 'FontSize', fsz, 'LineWidth', alw); %<- Set properties
title('Interpolated Result (Linear)')
xlabel('\alpha (rad)')
ylabel('R')
figure, plot(ID, alpha, '.-')
set(gca, 'FontSize', fsz, 'LineWidth', alw); %<- Set properties
title('\alpha')
xlabel('ID')
ylabel('\alpha')
figure, plot(ID, r, '.-')
set(gca, 'FontSize', fsz, 'LineWidth', alw); %<- Set properties
title('R')
xlabel('ID')
ylabel('R')

%% ----- Data Sampling -----
k = 512; % sampling points

[alpha_sample, idx] = datasample(alpha_intp, k);
idx = sort(idx);
alpha_sample = alpha_intp(idx);
r_sample = r_intp(idx);

%% ----- Data Smoothing -----
r_smooth = smooth(r_sample, 5, 'loess');
alpha_smooth = alpha_sample;

% plot smoothed data
figure, plot(alpha_smooth, r_smooth, 'y.'), hold on
set(gca, 'FontSize', fsz, 'LineWidth', alw); %<- Set properties
title('Sampled and Smoothed Data')
xlabel('\alpha (rad)')

%% ----- Find Peaks -----

% find local peaks
[r_peaks, locs] = findpeaks(r_smooth, 'MINPEAKDISTANCE', 5);
alpha_peaks = alpha_smooth(locs);

% plot all local peaks
% plot(alpha_peaks, r_peaks, 'ro'); % hold off

% select largest peaks
d = 10; % max distance away from a peak
n_peaks = length(r_peaks);
size_peaks = zeros(1, n_peaks);
for i = 1:n_peaks
    index = locs(i);
    sum = 0;
    for j = 1:d
        if (index + j) < (k + 1)
            sum = sum + (r_smooth(index) - r_smooth(index + j));
        end
        if (index - j) > 0
            sum = sum + (r_smooth(index) - r_smooth(index - j));
        end
    end
    size_peaks(i) = sum;
end
[size_peaks, index] = sort(size_peaks, 'descend');

% plot the 6 largest peaks
if n_peaks < 7
    plot(alpha_peaks, r_peaks, 'bo')
else
    plot(alpha_peaks(index(1)), r_peaks(index(1)), 'ro');
    plot(alpha_peaks(index(2)), r_peaks(index(2)), 'ko');
    plot(alpha_peaks(index(3)), r_peaks(index(3)), 'go');
    plot(alpha_peaks(index(4)), r_peaks(index(4)), 'co');
    plot(alpha_peaks(index(5)), r_peaks(index(5)), 'bo');
    plot(alpha_peaks(index(6)), r_peaks(index(6)), 'mo');
end
hold off

%% ----- Write Data to File -----
filename = 'sampled_512';
fid = fopen([filename, '.txt'], 'w');
% for i = 1:length(alpha_sample)
%     fprintf(fid, '%f\t%f\n', alpha_sample(i), r_sample(i));
% end
fprintf(fid, '%f ', alpha_sample);
fprintf(fid, '\n');
fprintf(fid, '%f ', r_sample);
fprintf(fid, '\n');
fclose(fid);








